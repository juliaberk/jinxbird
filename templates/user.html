{% extends 'base.html' %}
{% block content %}

<h2>{{ user.email }} ({{ user.user_id }})</h2>
<span id="confirm-add"></span>

<!-- The lat and long come from geolocation.js -->
<!-- Needs to disable # of birds field if not seen -->

<!-- this is the div containing the form for adding a new record -->
<div>
<form action="" id="record_form">
    User ID:<br>
        <input type="text"  id="user_id" value="{{ user.user_id }}"><br>
    Common Name:<br>
        <input type="text" id="common_name" value="{{ session.get("common_name") }}"><br>
    Date and Time:<br>
        <input type="text" id="date_time" value="{{user_datetime}}"><br>
    Latitude:<br>
        <input type="text" id="lat" id="lat" value="loading..."><br>
    Longitude:<br>
        <input type="text" id="lng" id="lng" value="loading..."><br>
    Notes:<br>
        <textarea id="notes"></textarea>
    <br>Seen?
        <input type="radio" name="seen" value="True">Yes</input>
        <input type="radio" name="seen" value="False">No</input>
    <br># of Birds:<br>
        <input type="text" id="num_birds" value="0"><br>

    <br><input type="button" id="record" value="Submit">
</form> 
</div>

<!-- AJAX for this record form -->
<script>
// Event listener calls this function
// 
function addNewRecord(evt){
     evt.preventDefault();

    // All the data from the form in here
    var formInputs = {
        "user_id": $("#user_id").val(),
        "common_name": $("#common_name").val(),
        "date_time": $("#date_time").val(),
        "lat": $("#lat").val(),
        "lng": $("#lng").val(),
        "notes": $("#notes").val(),
        "seen": $('input[name=seen]:checked').val(),
        "num_birds": $("#num_birds").val()
    };

    $.post('/add_record', formInputs, function(results) {
        // Tell the user their record has been added
        $('#confirm-add').text('Your new record has been saved');
        // The line below sets the fields that weren't pre-filled back to their
        // default. This is notes, seen? and # of birds:
        document.getElementById("record_form").reset();
        console.log(results);
    })
}

// Event listener on the submit button
$('#record').on('click', addNewRecord);

</script>
<!-- End of AJAX for adding a new record -->

<!-- List of all records goes in this div -->
<div>

    {% if records %}

    <table class="table">
        <thread>
            <tr>
                <th scope="col">Common Name</th>
                <th scope="col">Date/Time</th>
                <th scope="col">Latitude</th>
                <th scope="col">Longitude</th>
                <th scope="col">Notes</th>
                <th scope="col">Seen</th>
                <th scope="col"># Birds</th>
            </tr>
        </thread>
        <tbody>
            {% for record in records %}
            <tr>
                <th scope="row">{{ record.common_name }}</th>
                <td>{{ record.date_time }}</td>
                <td>{{ record.latitude }}</td>
                <td>{{ record.longitude }}</td>
                <td>{{ record.notes }}</td>
                <td>{{ record.seen }}</td>
                <td>{{ record.num_birds }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    {% endif %}

</div>

<!--     <ul>
        {% for record in records %}
          <li>
            {{ record.common_name }}
          </li>
        {% endfor %}
        </ul> -->


<!-- Geolocation for the records form -->
<script src="/static/js/geolocation.js"></script>

{% endblock %}