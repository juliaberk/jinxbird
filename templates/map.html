{% extends 'base.html' %}
{% block content %}

<!-- <script src="/static/birds.js"></script> -->

<script src="https://code.jquery.com/jquery-1.10.2.js"></script>

<p> {{ session.get("common_name") }} </p>
<p> {{ lat }} </p>
<p> {{ lng }} </p>


<head>
  <!-- I truthfully don't know where this came from or what it is -->
  <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
  <meta charset="utf-8">

<!-- CSS for the map -->
  <style>
    #map_wrapper {
        height: 600px;
    }

    #map_canvas {
        width: 100%;
        height: 100%;
    }
  </style>

</head>

<body>

  <!-- Map HTML -->

  <div id="map_wrapper">
      <div id="map_canvas" class="mapping"></div>
  </div>


  <!-- Map Javascript starts here. Will need to go into it's own file -->
<script>
  jQuery(function($) {
      // Asynchronously Load the map API 
      var script = document.createElement('script');
      script.src = "https://maps.googleapis.com/maps/api/js?key=AIzaSyDplp0jQKlQ9DBrhxT6HsG2DHJD3ZuwDHY&callback=initialize";
      document.body.appendChild(script);
  });

  function initialize() {
      var map;
      var bounds = new google.maps.LatLngBounds();
      var mapOptions = {
          mapTypeId: 'roadmap'
      };
                      
      // Display a map on the page
      map = new google.maps.Map(document.getElementById("map_canvas"), mapOptions);
      map.setTilt(45);


      // Beginning of ebird API 

      // This is the stuff the ebird API needs to get sighting info
      let data = {
            "lat": {{ lat }},
            "lng": {{ lng }},
            "speciesId": '{{ species_id }}'
       }

       // AJAX gives the API the data, get results and use them for markers
       $.get("/results.json", data, function (results) {
              alert(results.birds[1].howMany);
              console.log(results.birds[0].howMany)

          let sighting, marker, html; 

          for (let key in results.birds) {
              sighting = results.birds[key];


                // Define the marker
                marker = new google.maps.Marker({
                    position: new google.maps.LatLng(sighting.lat, sighting.lng),
                    map: map,
                    title: 'number: ' + results.birds.howMany,
                });
          }

        })

      // Automatically center the map fitting all markers on the screen
      map.fitBounds(bounds);

          //   // Override our map zoom level once our fitBounds function runs (Make sure it only runs once)
      var boundsListener = google.maps.event.addListener((map), 'bounds_changed', function(event) {
          this.setZoom(14);
          google.maps.event.removeListener(boundsListener);
      });
      
  }



</script> 

</body>



{% endblock %}